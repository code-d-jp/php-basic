# ユーザ定義関数

PHPの組み込み関数について様々なものを見てきました。ここでは関数を自作することにチャレンジしてみましょう。

> 私たちがPHPプログラマーが自作する関数のことをユーザ定義関数と呼びます。

## 関数の定義

まずは簡単な計算を行う関数を定義してみましょう。次のプログラム（func1.php）は引数で受け取った金額に税率（1.08）を掛けて返却するものです。

```
<?php
function calc($price) {
  $result = $price * 1.08;
  return $result;
}

$price1 = calc(100);
echo $price1 . PHP_EOL;

$price2 = calc(1000);
echo $price2 . PHP_EOL;
```

まずは作成したプログラムを実行してみましょう。ターミナルから次のように実行します。

```
$ php func1.php
108
1080
```

それではプログラムの詳細を見てみましょう。

PHPで関数を定義するには`function`キーワードを使います。

```
function calc($price) {
  $result = $price * 1.08;
  return $result;
}
```

上記のように`function`キーワードの後に関数名`calc`と`()`の中に引数`$price`を指定します。`calc`関数の処理ブロック`{}`の中では`$result = $price * 1.08;`税率を掛け合わせた後`return`キーワードが登場します。`return`キーワードは戻り値を返却するためのもので`return $result;`とすることで`$result`変数のデータを戻り値として返却することができます。

`function`キーワードで定義した関数は、組み込み関数と同様に呼び出すことができます。`calc`関数の呼び出し部分を見てみましょう。

```
$price1 = calc(100);
```

関数を呼び出す際には、まず関数名`calc`と引数`()`を記述します。`calc`関数は1つの引数を受け取るように定義していたので上記のように`calc(100)`と記述できます。また`calc`関数を呼び出すと戻り値が返却されるので、関数呼び出し`calc(100)`の前に変数`$price1`を定義して代入演算子`=`によって戻り値を`$price1`に代入しています。

また一度定義した関数は何度も呼び出すことができます。

```
$price1 = calc(100);
echo $price1 . PHP_EOL;

$price2 = calc(1000);
echo $price2 . PHP_EOL;
```

上記のようにcalc関数を2回呼び出すことも可能です。

## 関数を定義する理由

プログラミングを始めて間もない頃は、関数の定義を面倒に感じることもあるかもしれません。一般的には関数を定義することで次のようなメリットが生まれます。

+ 処理の再利用
+ メンテナンス性の向上
+ 可読性の向上

1つは処理の再利用です。関数は一度定義してしまえば他のプログラムから簡単に呼び出すことができます。同じようなプログラムの記述が存在する場合、関数として定義しておけばプログラムを再利用できるようになります。

もう一つはメンテナンス性の向上です。プログラムは一度作成したら完成というわけではなく、様々な理由で修正作業が生まれます。例えば税率の変更などです。先ほどのプログラム（func1.php）ように税率の計算をcalc関数の中に定義しておくことで、もし将来、税率が変更となった場合も修正箇所は1箇所を直すだけで済むようになります。

また関数を適切に定義することでプログラムの可読性の向上にもつながります。関数の目的を明確にして、適切な名前を付けることでプログラムはとても読みやすくなります。さきほどのプログラム（func1.php）の場合は`calc`（計算）という名前を付けましたが`add_tax`のような名前の方が具体的でわかりやすいかもしれません。

## 引数の定義

関数には任意の数の引数を定義できます。次のプログラム（func2.php）を作成してみましょう。

```
<?
function sum($x, $y, $z) {
  return $x + $y + $z;
}

$result = sum(100, 200, 300);
echo $result . PHP_EOL;
```

上記の`sum`関数は3つの引数を受け取るように定義しています。そのためsum関数の呼び出し部分は次のようになります。

```
$result = sum(100, 200, 300);
```

> 引数の数が3つあるところを確認してください。

プログラムを実行してみましょう。ターミナルから次のように実行します。

```
$ php func2.php
600
```

実行結果から3つの引数を合計した値が出力されているのがわかります。

もう一つ引数をとらない関数を見てみましょう。次のプログラム（func3.php）を作成してみましょう。

```
<?
function hello() {
  return "Hello";
}

$result = hello();
echo $result . PHP_EOL;
```

上記の`hello`関数は引数を受け取りません。そのためhello関数の呼び出し部分も次のようになります。

```
$result = hello();
```

プログラムを実行してみましょう。ターミナルから次のように実行します。

```
$ php func3.php
Hello
```

`hello`関数の戻り値である`"Hello"`が出力されているのがわかります。

## 戻り値の定義

これまでに見てきたとおり、戻り値は`return`キーワードで指定します。ただし、戻り値は引数のように複数返却することはありません。

> 複数の意味に注意してください。戻り値に配列を返却することは可能です。

また戻り値を返さない関数を定義することもできます。次のプログラム（func4.php）を作成してみましょう。

```
<?php
function greet($name) {
  echo "Hello $name" . PHP_EOL;
}

greet("Andy");
```

greet関数の中にreturnキーワードが存在しない点に注意してください。greet関数は引数で受け取った値をecho命令によって出力しています。


プログラムを実行してみましょう。ターミナルから次のように実行します。

```
$ php func4.php
Hello Andy
```

実行結果からgreet関数の中で`"Hello Andy"`と出力されているのがわかります。

> 戻り値のない関数の呼び出しは `$result = greet("Andy");` とならない点に注意してください。戻り値がないため`greet("Andy");`のように関数を呼び出すだけになります。

